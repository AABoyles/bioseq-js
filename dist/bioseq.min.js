!function(r,e){"function"==typeof define&&define.amd?define([],function(){return r.bioseq=e()}):"object"==typeof module&&module.exports?module.exports=e():r.bioseq=e()}("undefined"!=typeof self?self:this,function(){"use strict";var r={makeIntArray:function(r,e,n){var t=e<=16?new Int16Array(r):new Int32Array(r),a=e<=8?new Int8Array(r):t,o="undefined"!=typeof Int8Array,u=o?a:[];if(!o||0!==n&&void 0!==n)for(var f=0;f<r;f++)u[f]=n;return u},makeAlphabetMap:function(e,n){for(var t=r.makeIntArray(256,8,n),a=e.toLowerCase(),o=0;o<e.length;o++)t[e.charCodeAt(o)]=o,t[a.charCodeAt(o)]=o;return t}};return r.nt5=r.makeAlphabetMap("ACGT",4),r.nac=r.makeAlphabetMap("ACGTURYMKWSBDHVN",16),r.aac=r.makeAlphabetMap("ARNDCQEGHILKMFPSTWYVBZX",32),r.align=function(e,n,t,a,o,u,f){void 0===t&&(t=!0),void 0===a&&(a=[1,-1]),void 0===o&&(o=[-1,-1]),null==f&&(f=r.nt5);var l=r.bsg_enc_seq(e,f),i=r.gen_query_profile(n,a,f),g=i[0].length,s=g>l.length?g:l.length;u=null==u||u<0?s:u;var h,c,v=l.target>g?l.target-g:g-l.target;u=u>v?u:v,"number"==typeof o?(h=0,c=o>0?o:-o):(h=o[0]>0?o[0]:-o[0],c=o[1]>0?o[1]:-o[1]);var p,A=h+c,I=[],b=[],m=[],y=0,N=-1,d=-1;if(t)for(var _=0;_<=g;++_)I[_]=b[_]=0;else{I[0]=0,b[0]=-A-h;for(_=1;_<=g;++_)_>=u?I[_]=b[_]=Number.NEGATIVE_INFINITY:(I[_]=-(A+c*(_-1)),b[_]=-(A+A+c*_))}for(var T=0;T<l.length;++T){var E,C=0,G=0,q=0,M=-1,k=i[l[T]];E=m[T]=[];var V=T>u?T-u:0,Y=T+u+1<g?T+u+1:g;t||(C=V>0?Number.NEGATIVE_INFINITY:-(A+c*T),G=V>0?Number.NEGATIVE_INFINITY:-(A+A+c*T));for(_=V;_<Y;++_){var w,F=b[_],j=I[_];I[_]=C,w=(j+=k[_])>F?0:1,w=(j=j>F?j:F)>G?w:2,j=j>G?j:G,w=!t||j>0?w:64,C=j,M=q>j?M:_,q=q>j?q:j,j-=A,w|=(F-=c)>(j=!t||j>0?j:0)?4:0,F=F>j?F:j,b[_]=F,w|=(G-=c)>j?32:0,G=G>j?G:j,E[_]=w}I[Y]=C,b[Y]=t?0:Number.NEGATIVE_INFINITY,q>y&&(y=q,N=T,d=M)}if(t&&0==y)return null;function x(r,e,n){0==r.length||e!=(15&r[r.length-1])?r.push(n<<4|e):r[r.length-1]+=n<<4}p=t?y:I[g];var S,B,D=[],H=0,R=0;for(t?(T=N,B=d,d!=g-1&&x(D,4,g-1-d)):B=((T=l.length-1)+u+1<g?T+u+1:g)-1;T>=0&&B>=0&&!(0==(H=(S=m[T][B-(T>u?T-u:0)])>>(H<<1)&3)&&S>>6);)0==H&&(H=3&S),0==H?(x(D,0,1),--T,--B):1==H?(x(D,2,1),--T):(x(D,1,1),--B);t?(B>=0&&x(D,4,B+1),R=T+1):(T>=0&&x(D,2,T+1),B>=0&&x(D,1,B+1));for(T=0;T<D.length>>1;++T)S=D[T],D[T]=D[D.length-1-T],D[D.length-1-T]=S;return{score:p,position:R,CIGAR:D}},r.gen_score_matrix=function(r,e,n){var t=[];n>0&&(n=-n);for(var a=0;a<r-1;++a){t[a]=[];for(var o=0;o<r-1;++o)t[a][o]=a==o?e:n;t[a][o]=0}t[r-1]=[];for(o=0;o<r;++o)t[r-1][o]=0;return t},r.gen_query_profile=function(e,n,t){var a,o="string"==typeof e?r.bsg_enc_seq(e,t):e,u=[];if(n.length>=2&&"number"==typeof n[0]&&"number"==typeof n[1]){if(null==t)return null;var f="number"==typeof t?t:t[t.length-1]+1;a=r.gen_score_matrix(f,n[0],n[1])}else a=n;for(var l=0;l<a.length;++l){var i,g=a[l];i=u[l]=[];for(var s=0;s<o.length;++s)i[s]=g[o[s]]}return u},r.bsg_enc_seq=function(e,n){null==n&&(n=r.nt5);for(var t=new Array(e.length),a=0;a<e.length;++a)t[a]=n[e.charCodeAt(a)];return t},r.cigar2str=function(r){for(var e=[],n=0;n<r.length;++n)e.push((r[n]>>4).toString()+"MIDNSHP=XB".charAt(15&r[n]));return e.join()},r.cigar2gaps=function(r,e,n,t){for(var a="",o="",u=0,f=n,l=0;l<t.length;++l){var i=15&t[l],g=t[l]>>4;0==i?(a+=e.substr(u,g),o+=r.substr(f,g),u+=g,f+=g):1==i?(a+=e.substr(u,g),o+=Array(g+1).join("-"),u+=g):2==i?(a+=Array(g+1).join("-"),o+=r.substr(f,g),f+=g):4==i&&(u+=g)}return[o,a]},r});
